{% extends "cm_portal/nursing_home_index.html" %}

{% block title %}| Resident Profile{% endblock %}

{% block page_title %}| Resident Profile{% endblock %}

{% load static %}

{% block nav_resident %}
<li class="nav-item active">
  <a class="nav-link" href="#">Resident Profile<span class="sr-only">(current)</span></a>
</li>
<li class="{% if resident.medicalabstract.get_absolute_url %}
  nav-item{% else %}nav-item disabled{% endif %}">
  <a class="nav-link" href="{% if resident.medicalabstract.get_absolute_url %}
  {{ resident.medicalabstract.get_absolute_url }}{% else %}#{% endif %}">Medical Abstract</a>
</li>
{% endblock %}
{% block content %}  
  {% if resident.vital_status != 'LI' %}
  <h2><strong class="{% if resident.vital_status == 'DE' %}text-danger{% elif resident.vital_status == 'DC' %}text-warning{% endif %}">
  {{ resident.get_vital_status_display|upper }}  
  </strong></h2>  
  {% endif %}
  <h2>Name: {{ resident.first_name }} 
    {% if resident.middle_name %}
      {{ resident.middle_name|first }}.            
    {% endif %} {{ resident.last_name }}</h2>
  
  <div class="container">
    <div class="col-md-4" style="padding-left: 0px;  padding-right: 0px;">
      {% if resident.photo %}
      <img src="{{ resident.photo.url }}" class="img-thumbnail" alt="Responsive image" width="300" height="199">
      {% else %}
      <img src="{% static 'images/avatar.png' %}" class="img-thumbnail" alt="">
      {% endif %}
    </div>
  </div>
    
  <table class="table table-sm table-hover">
    {% if resident.vital_status == 'DE' and resident.died_on %}
    <tr>
      <td><strong class="text-danger">Died on: </strong>{{ resident.died_on }}</td>    
    </tr>
    {% elif resident.vital_status == 'DC' and resident.discharged_on %}
    <tr>
      <td><strong class="text-warning">Discharged on: </strong>{{ resident.discharged_on }}</td>    
    </tr>
    {% endif %}
    <tr>
      <td><strong>Reminder(s): </strong>{{ resident.reminders }}</td>          
    </tr>
    <tr>
      <td><strong>Diagnosis: </strong>{{ resident.admitting_diagnosis }}</td>
      <td><strong>Diet: </strong>{{ resident.diet }}</td>
    </tr>  
    <tr>
      <td><strong>Weight: </strong>{{ resident.weight }}</td>
      <td><strong>Height: </strong>{{ resident.height }}</td>
    </tr>      
    <tr>
      <td><strong>Surname: </strong>{{ resident.last_name }}</td>
      <td><strong>First Name: </strong>{{ resident.first_name }}</td>
      <td><strong>Middle Name: </strong>{{ resident.middle_name }}</td>    
    </tr>
    <tr>
      <td><strong>Age: </strong>{{ resident.birth_date|timesince }}</td>
      <td><strong>Sex: </strong>{% if resident.gender  == 'M' %} Male{% else %} Female{% endif%}</td>
      <td><strong>OSCA ID #: </strong>{{ resident.osca_id }}</td>    
    </tr>
    <tr>
      <td><strong>Address: </strong>{{ resident.address }}</td>    
    </tr>
    <tr>
      <td><strong>Birth Date: </strong>{{ resident.birth_date }}</td>
      <td><strong>Birth Place: </strong>{{ resident.birth_place }}</td>
      <td><strong>Nationality: </strong>{{ resident.nationality }}</td>    
    </tr>
    <tr>
      <td><strong>Civil Status: </strong>{% if resident.civil_status  == 'S' %}Single
                                   {% elif resident.civil_status == 'M' %}Married
                                   {% else %}Widowed
                                   {% endif%}</td>
      <td><strong>Most Recent Occupation: </strong>{{ resident.most_recent_occupation }}</td>    
    </tr>
    <tr>
      <td><strong>Date of Admission: </strong>{{ resident.admission_date }}</td>
      <td><strong>Time of Admission: </strong>{{ resident.admission_time }}</td>
      <td><strong>Religion: </strong>{{ resident.religion }}</td>    
    </tr>
  </table>  
  {% if resident.relationship_set.all or resident.physicians.all %}
  <table class="table table-hover">
    <thead><h4>Contact Person(s)</h4></thead>
    {% for relationship in resident.relationship_set.all %}
      {% for relative in relationship.relative_set.all %}
        <tr><td><strong>Name: </strong>
        <a href="{% url 'relative-detail' relative.pk %}" >{{relative.first_name}} {{relative.middle_name }} {{ relative.last_name }}</a></td>
        <td><strong>Relation: </strong>{{ relationship.relation }}</td>
        <td><strong>Telephone #: </strong>{{ relative.telephone }}</td></tr>
      {% endfor %}
    {% endfor %}  
    {% for physician in resident.physicians.all %}
      <tr>
        <td><strong>Physician: </strong><a href="{% url 'physician-detail' physician.pk %}" > 
        Dr. {{ physician.first_name }} {{ physician.middle_name }} {{ physician.last_name}}</a></td>
        <td><strong>Contact #: </strong>{{ physician.telephone }}</td>    
        <td><strong>HOC: </strong>{{ physician.hospital_of_choice }}</td>  
      </tr>
    {% endfor%}
  </table>
  {% endif %}
  
  {% if perms.cm_portal.change_resident and perms.cm_portal.delete_resident %}
    <a class="btn btn-primary" href="{% url 'resident-update' resident.id %}" role="button">Edit</a>  
    <a class="btn btn-danger" href="{% url 'resident-delete' resident.id %}" role="button">Delete</a>
  {% elif perms.cm_portal.change_resident %}
    <a class="btn btn-primary" href="{% url 'resident-update' resident.id %}" role="button">Edit</a>  
    <a class="btn btn-danger disabled" href="{% url 'resident-delete' resident.id %}" role="button">Delete</a>
  {% else %}
    <a class="btn btn-primary disabled" href="{% url 'resident-update' resident.id %}" role="button">Edit</a>  
    <a class="btn btn-danger disabled" href="{% url 'resident-delete' resident.id %}" role="button">Delete</a>
  {% endif %}
{% endblock %}